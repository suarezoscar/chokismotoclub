<div class="news-container">
  <h2>Ãšltimas Noticias</h2>

  <!-- Loading state with spinner -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner-container">
      <div class="spinner"></div>
      <p>Cargando noticias...</p>
    </div>
  </div>

  <!-- Error state -->
  <div *ngIf="error && !loading" class="error-state">
    <p>âŒ {{ error }}</p>
    <button (click)="cargarNoticias()" class="retry-button">ğŸ”„ Reintentar</button>
  </div>

  <!-- Noticias -->
  @if(!loading && !error && noticias.length > 0){

  <div class="news-items">
    <div *ngFor="let noticia of noticias; trackBy: trackByNoticia" class="news-item"
      [class.no-image]="!hasValidImage(noticia) || noticia._imageError">

      <!-- Solo mostrar imagen si existe, es vÃ¡lida y no ha fallado -->
      <div class="news-image" *ngIf="hasValidImage(noticia) && !noticia._imageError">
        <img [src]="getImageSrc(noticia)" [alt]="noticia.titulo" (error)="onImageError($event, noticia)"
          (load)="onImageLoad(noticia)" loading="lazy">
      </div>

      <!-- Placeholder visual cuando no hay imagen o fallÃ³ la carga -->
      <div class="news-placeholder" *ngIf="!hasValidImage(noticia) || noticia._imageError">
        <div class="placeholder-content">
          <div class="placeholder-icon">ğŸ“°</div>
          <span class="placeholder-text">{{ noticia.titulo | slice:0:30 }}...</span>
        </div>
      </div>

      <div class="news-content">
        <h3>{{ noticia.titulo }}</h3>
        <div class="news-date">{{ formatearFecha(noticia.fecha_publicacion) }}</div>
        <p>{{ noticia.cuerpo }}</p>
      </div>
    </div>
  </div>
  }
  @else if (!loading && !error && noticias.length === 0) {
  <!-- Mensaje si no hay noticias (solo cuando no estÃ¡ cargando y no hay error) -->
  <div *ngIf="" class="no-news">
    <p>ğŸ“­ No hay noticias disponibles en este momento.</p>
  </div>
  }
</div>